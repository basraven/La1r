<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Network Architecture"><meta property="og:title" content="Network Architecture"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://la1r.com/docs/technical-architecture/infrastructure-architecture/network-architecture/"><title>Network Architecture | La1r</title><link rel=icon href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/book.min.9d4a50a3f8215d92699ad8fffed3f7e077b3115be0ead58de83527db7f5ce38c.css integrity="sha256-nUpQo/ghXZJpmtj//tP34HezEVvg6tWN6DUn239c44w="><script defer src=/en.search.min.371e60a515075d789a013c182d71461e7a47644417727454114fe3bba8cf0c06.js integrity="sha256-Nx5gpRUHXXiaATwYLXFGHnpHZEQXcnRUEU/ju6jPDAY="></script><link rel=alternate type=application/rss+xml href=https://la1r.com/docs/technical-architecture/infrastructure-architecture/network-architecture/index.xml title=La1r></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=https://la1r.com/><span class=brand-title>| &nbsp;&nbsp;La1r</span><img src=/svg/lair-icon-dark.svg alt=Logo></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul class=pre-inject-menu><li><strong><a href=/>La1r</a></strong></li></ul><ul><li><a href=/docs/capability-architecture/>Capability Architecture</a><ul><li><a href=/docs/capability-architecture/event-specifications/>Event Specifications</a><ul></ul></li><li><a href=/docs/capability-architecture/governance-catalogs/>Governance Catalogs</a><ul></ul></li></ul></li><li><a href=/docs/technical-architecture/>Technical Architecture</a><ul><li><a href=/docs/technical-architecture/application-architecture/>Application Architecture</a></li><li><a href=/docs/technical-architecture/data-architecture/>Data Architecture</a><ul></ul></li><li><a href=/docs/technical-architecture/infrastructure-architecture/>Infrastructure Architecture</a><ul><li><a href=/docs/technical-architecture/infrastructure-architecture/deployment-architecture/>Deployment Architecture</a></li><li><a href=/docs/technical-architecture/infrastructure-architecture/storage-architecture/>Storage Architecture</a><ul></ul></li><li><a href=/docs/technical-architecture/infrastructure-architecture/network-architecture/ class=active>Network Architecture</a><ul></ul></li></ul></li><li><a href=/docs/technical-architecture/operations-architecture/>Operations Architecture</a></li><li><a href=/docs/technical-architecture/security-architecture/>Security Architecture</a></li></ul></li><li><a href=/docs/planning/>Planning</a><ul></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class="flex align-center justify-between book-header"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Network Architecture</strong></header><article class=markdown><h2 id=network-architecture>Network Architecture</h2><p>The network setup is of la1r.com is not a simple one, this due to several reasons:</p><ul><li>Multi-site setup, with servers on different locations, connected either directly or through vpn</li><li>Multi-tenancy setup, multiple layers of access on the network need to be implemented</li><li>Multiple vpn endpoints, this to connect the different tenants</li><li>Multiple servers within a single Kubernetes cluster.</li><li>Virtual network interfaces with virtual network policies in Kubernetes.</li><li>Multiple networking hardware devices such as routers, managed switches and IOT devices.</li></ul><p>To break down these complexities we can split the network architecture into two parts:</p><ol><li>Technical Layer - (<a href="https://en.wikipedia.org/wiki/OSI_model#:~:text=The%20Open%20Systems%20Interconnection%20model,underlying%20internal%20structure%20and%20technology">OSI</a> layers 1 - 4)</li><li>Data Layer - (<a href="https://en.wikipedia.org/wiki/OSI_model#:~:text=The%20Open%20Systems%20Interconnection%20model,underlying%20internal%20structure%20and%20technology">OSI</a> layers 5 - 7)</li></ol><h3 id=network-topology-table>Network topology table</h3><p>The following table summarizes all network cidrs and addresses</p><table><thead><tr><th>Prefix</th><th>CIDR</th><th>IP</th><th>Target</th><th>vlan</th></tr></thead><tbody><tr><td>192.168</td><td>1.0/24</td><td></td><td>Empty, not used, will indicate wrongly configured devices</td><td>-</td></tr><tr><td>192.168</td><td>2.0/24</td><td></td><td>Common devices, laptops, phones, etc.</td><td>1</td></tr><tr><td>192.168</td><td>3.0/24</td><td></td><td>IOT Devices with dedicated connection to server</td><td>1</td></tr><tr><td>192.168</td><td>4.0/24</td><td></td><td>Network infrastructure, switches, routers, etc</td><td>1</td></tr><tr><td>192.168</td><td>4.0/24</td><td>4.1</td><td>Router and DHCP Server</td><td>1</td></tr><tr><td>192.168</td><td>4.0/24</td><td>4.2</td><td>Central network switch</td><td>1</td></tr><tr><td>192.168</td><td>4.0/24</td><td>4.3</td><td>Access Point living room</td><td>1</td></tr><tr><td>192.168</td><td>4.0/24</td><td>4.4</td><td>Access Point office</td><td>1</td></tr><tr><td>192.168</td><td>5.0/24</td><td></td><td>Servers</td><td>1</td></tr><tr><td>192.168</td><td>5.0/24</td><td>5.1</td><td>linux-wayne</td><td>1</td></tr><tr><td>192.168</td><td>5.0/24</td><td>5.2</td><td>50centos</td><td>1</td></tr><tr><td>192.168</td><td>6.0/24</td><td></td><td>Kubernetes MetalLB services</td><td>1</td></tr><tr><td>192.168</td><td>6.0/25</td><td></td><td>LAN Kubernetes MetalLB services</td><td>1</td></tr><tr><td>192.168</td><td>6.0/25</td><td>6.1</td><td>LAN Traefik 2.x on linux-wayne</td><td>1</td></tr><tr><td>192.168</td><td>6.0/25</td><td>6.2</td><td>LAN Traefik 2.x on 50centos</td><td>1</td></tr><tr><td>192.168</td><td>6.0/25</td><td>6.100</td><td>DNS Blackhole (pihole)</td><td>1</td></tr><tr><td>192.168</td><td>6.128/25</td><td></td><td>Online Kubernetes MetalLB services</td><td>1</td></tr><tr><td>192.168</td><td>6.128/25</td><td>6.128</td><td>Online Traefik 2.x on linux-wayne</td><td>1</td></tr><tr><td>192.168</td><td>6.128/25</td><td>6.129</td><td>Online Traefik 2.x on 50centos</td><td>1</td></tr><tr><td>10.244</td><td>0.0/16</td><td></td><td>Kubernetes internal cidr</td><td>kubernetes.local</td></tr><tr><td>10.8</td><td>2.0/24</td><td></td><td>Shared VPN access</td><td>openvpn shared</td></tr><tr><td>10.8</td><td>2.0/24</td><td>2.1</td><td>Shared VPN server</td><td>openvpn shared</td></tr><tr><td>10.8</td><td>4.0/24</td><td></td><td>Private VPN access</td><td>openvpn private</td></tr><tr><td>10.8</td><td>4.0/24</td><td>4.1</td><td>Private VPN server</td><td>openvpn private</td></tr></tbody></table><h3 id=technical-layer>Technical Layer</h3><blockquote><p><strong>TODO: Update diagram with new hardware</strong></p></blockquote><p>The Technical Layer is structured as follows:</p><p><img src=/images/la1r-diagrams-Network%20Arch%20-%20Technical%20Layer.png alt></p><h3 id=network-with-weaveworks>Network with WeaveWorks</h3><p>Initially the decision was made to use flannel as network provider, since this is a pretty standard choice for many k8s implementations. Unfortunately this gave several networking, performance and upgrading issues over time, especially with our multi cpu architecture environment. After a tool selection process weave works came out best because:</p><ul><li>Substantial performance and stability improvements</li><li>Capable of complex network segregation which flannel was not able to do</li><li>Easy to setup, even if several sources on the way point out the opposite</li><li>Bonus: Weave works supplies a fancy and comprehensive dashboard of your entire network</li></ul><h3 id=data-layer>Data Layer</h3><p>The Data Layer is structured as follows:</p><p><img src=/images/la1r-diagrams-Network%20Arch%20-%20Data%20Layer.png alt></p></article><div class="book-footer justify-between"><div><a class="flex align-center" href=https://github.com/basraven/la1r/commit/43a3fb7bc7fd69e949520d556deff5a618ba3cfe title="Last modified by Sebastiaan Raven | Aug 17, 2020" target=_blank><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Aug 17, 2020</span></a></div></div></div><aside class="book-toc levels-true fixed"><nav id=TableOfContents><ul><li><ul><li><a href=#network-architecture>Network Architecture</a><ul><li><a href=#network-topology-table>Network topology table</a></li><li><a href=#technical-layer>Technical Layer</a></li><li><a href=#network-with-weaveworks>Network with WeaveWorks</a></li><li><a href=#data-layer>Data Layer</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>