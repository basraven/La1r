---
- hosts: all
  remote_user: "{{ target_user }}"
  tasks:
      - name: Add an Apt signing key, uses whichever key is at the URL
        apt_key:
          url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
          state: present
        become: True
      - name: Add key to repo
        apt_repository:
            repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
            state: present
        become: True
      - name: Update apt-get
        command: apt-get update -q 
        become: True
      - name: Install K8s
        command: apt-get install -yq kubeadm kubectl kubelet
        become: True
      - name: Remove swap
        command: swapoff -a
        become: True
